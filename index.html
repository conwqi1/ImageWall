<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chute Coding Challenge</title>
    <link rel="stylesheet" type="text/css" href="style/chute.css" />
    <script src="scripts/jquery-2.1.1.js"></script>
    <script src="scripts/underscore.js"></script>
    <script src="scripts/backbone.js"></script>
    <script type="text/javascript" src="scripts/masonry.pkgd.min.js"></script>
  </head>

  <body>
    <div class='header'>
      <div class="clearfix">
        <div class="float-left">
            <h1><a href="http://vnjs.net/www/project/freewall/">Free Wall</a></h1>
            <div class='target'>Creating dynamic grid layouts.</div>
        </div>
      </div>
    </div>

    <div id="chute">

    </div>


<!--templates -->
    <script type="text/template" id="card-template">
        <% cards.each(function (card) { %>
          <div class="item">  
             <img src="<%= card.get('url') %>/fit/500x300">
             <div class="info">
               111

             </div>
          </div>
        <% }); %>
     </script>



     <script>

        var container = $('.cards-container');
        container.masonry({
          isAnimated:true,
          columnWidth:300,
          itemSelector:'.item'
         })

        var Cards = Backbone.Collection.extend({
          url: "https://api.getchute.com/v2/albums/aus6kwrg/assets?type=image&tags=surf&page=1&per_page=50",
          parse: function(data){
            return data.data;
          }
        });
        var cards = new Cards();

        var CardsIndex = Backbone.View.extend({
          $el: $('#chute'),
          className: "cards-container",
          tagName: "div",
          template: _.template($('#card-template').html()),
          initialize: function(){
            this.listenTo(this.collection, "sync", this.render);
          }, 
          events:{'scroll':'loadmore','click .lightbox':'showLightBox'},

          loadmore:function(){

          },

          showLightBox:function(){

          },

          render: function(){
            var renderContent = this.template({
              cards: this.collection
            });
            this.$el.html(renderContent); 
            return this;
          }, 
        });


       var Router = Backbone.Router.extend({
        initialize: function(options){
          this.$rootEl = options.$root
        },
        routes: { '': 'cardsIndex'},
        
        cardsIndex: function(){
          var collection = cards;
          collection.fetch();
          var view = new CardsIndex({
            collection: cards
          });
          this._swapView(view);
        },
        
        _swapView: function(view){
         this._currentView && this._currentView.remove();
         this._currentView = view; 
         this.$rootEl.html(view.render().$el);
        }
      });  
      var router = new Router({$root: $('#chute')})
      Backbone.history.start();
     </script>
  </body>
</html>



